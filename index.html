<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High-Tech Maths | Velo Computing</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{margin:0;padding:0;font-family:Inter,sans-serif;background:#0f111a;color:#fff;}
header{background:#1a1c2b;padding:15px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 10px rgba(0,0,0,0.3);}
header img{height:40px;margin-right:10px;}
header div{display:flex;align-items:center;}
button{padding:8px 14px;margin:5px;border:none;border-radius:6px;cursor:pointer;background:#0A66C2;color:#fff;font-weight:500;}
.container{padding:20px;max-width:900px;margin:auto;}
.card{background:#1e2030;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.2);}
input,select{padding:8px;margin:5px;width:100%;border-radius:6px;border:none;}
h3{margin-bottom:10px;color:#0A66C2;}
.hidden{display:none;}
.quiz-question{margin-bottom:12px;}
</style>
</head>
<body>

<header>
<div>
<img src="DailyMaths logo.png" alt="DailyMaths Logo">
<b>High-Tech Maths</b> • Velo Computing
</div>
<div>
<button id="loginBtn">Login / Save Progress</button>
<button id="logoutBtn" class="hidden">Logout</button>
</div>
</header>

<div class="container">

<!-- Problem Type Selector -->
<div class="card">
<h3>Select Problem Type</h3>
<select id="problemType">
  <option value="arithmetic">Arithmetic</option>
  <option value="algebra">Algebra</option>
  <option value="geometry">Geometry</option>
  <option value="trigonometry">Trigonometry</option>
  <option value="logic">Logic</option>
</select>
<button id="generateBtn">Generate Problems</button>
</div>

<!-- Quiz Area -->
<div id="quizCard" class="card hidden">
<h3>Problems</h3>
<div id="quizArea"></div>
<button id="submitBtn">Submit Answers</button>
<div id="quizResult" style="margin-top:15px;color:#0A66C2;"></div>
</div>

</div>

<script>
// -----------------------------
// Supabase Setup (Optional Save)
// -----------------------------
const SUPABASE_URL = "https://lqkpxervwakucksrnoss.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_Sdi0YJz0IPwK9yV-0tLvCw_9IDZQhD8";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;
let questions = [];

// -----------------------------
// Login / Logout
// -----------------------------
window.login = async function(){
  const email = prompt("Enter email (optional to save progress)");
  if(!email) return alert("Progress will be temporary in this session.");
  const {data, error} = await supabaseClient.auth.signInWithOtp({email});
  if(error) return alert(error.message);
  alert("Check your email to complete login!");
};
window.logout = async function(){
  await supabaseClient.auth.signOut();
  currentUser = null;
  alert("Logged out. Progress will be temporary.");
};
document.getElementById("loginBtn").addEventListener("click", login);
document.getElementById("logoutBtn").addEventListener("click", logout);

// -----------------------------
// Problem Generation
// -----------------------------
function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

function generateProblem(type){
  switch(type){
    case "arithmetic":
      const a=randomInt(1,50), b=randomInt(1,50);
      return {question:`${a} + ${b} = ?`, answer: a+b};
    case "algebra":
      const x=randomInt(1,10), y=randomInt(1,10);
      return {question:`Solve: ${x}x + ${y} = ${x*y + y}`, answer:1};
    case "geometry":
      const side=randomInt(1,20);
      return {question:`Square with side ${side}. Area = ?`, answer: side*side};
    case "trigonometry":
      const angle=[30,45,60][randomInt(0,2)];
      return {question:`sin(${angle}°) rounded to 2 decimals = ?`, answer: Math.round(Math.sin(angle*Math.PI/180)*100)/100};
    case "logic":
      const n=randomInt(1,10);
      return {question:`Next in sequence: ${n}, ${n+1}, ${n+3}, ?`, answer: n+6};
    default: return {question:"1+1=?", answer:2};
  }
}

document.getElementById("generateBtn").addEventListener("click", ()=>{
  const type = document.getElementById("problemType").value;
  questions=[];
  const area = document.getElementById("quizArea");
  area.innerHTML="";
  for(let i=0;i<10;i++){
    const p = generateProblem(type);
    questions.push(p);
    area.innerHTML += `<div class="quiz-question">${i+1}. ${p.question} <input id="q${i}" placeholder="Answer"></div>`;
  }
  document.getElementById("quizCard").classList.remove("hidden");
  document.getElementById("quizResult").textContent="";
});

// -----------------------------
// Submit Answers
// -----------------------------
document.getElementById("submitBtn").addEventListener("click", async ()=>{
  let score=0;
  for(let i=0;i<questions.length;i++){
    let val=document.getElementById("q"+i).value;
    if(val != "" && parseFloat(val)==questions[i].answer) score++;
  }
  document.getElementById("quizResult").textContent=`Score: ${score}/${questions.length}`;

  if(currentUser){
    await supabaseClient.from("saved_results").insert({
      user_id: currentUser.id,
      score:score,
      total:questions.length,
      type: document.getElementById("problemType").value,
      created_at: new Date()
    });
  }
});
</script>

</body>
</html>
