<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NailLang - English Learning</title>
<link rel="icon" href="https://cdn.velocomputing.tech/DailyMaths%20logo.png">
<style>
body { font-family: 'Arial', sans-serif; background:#f0f0f0; color:#222; padding:20px; }
h1 { text-align:center; }
.quiz-box { background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); margin-bottom:20px; }
input, button { padding:10px; font-size:16px; margin-top:10px; }
.result { margin-top:10px; font-weight:bold; }
#loginBox { display:flex; flex-direction:column; max-width:300px; margin:auto; }
</style>
</head>
<body>

<h1>NailLang - English Learning</h1>

<!-- LOGIN -->
<div id="loginBox" class="quiz-box">
  <h2>Login (optional)</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="logout()">Logout</button>
  <div id="loginResult" class="result"></div>
</div>

<!-- VOCAB QUIZ -->
<div id="vocabQuiz" class="quiz-box">
  <h2>Vocabulary Quiz</h2>
  <div id="vocabQuestion">Loading...</div>
  <input id="vocabAnswer" placeholder="Type your answer">
  <button onclick="submitVocab()">Submit</button>
  <div id="vocabResult" class="result"></div>
</div>

<!-- SENTENCE QUIZ -->
<div id="sentenceQuiz" class="quiz-box">
  <h2>Sentence Construction</h2>
  <div id="sentenceQuestion">Loading...</div>
  <input id="sentenceAnswer" placeholder="Construct the sentence correctly">
  <button onclick="submitSentence()">Submit</button>
  <div id="sentenceResult" class="result"></div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const SUPABASE_URL = "https://lqkpxervwakucksrnoss.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_Sdi0YJz0IPwK9yV-0tLvCw_9IDZQhD8";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentVocab, currentSentence;

// -------- LOGIN ----------
async function login() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const resultDiv = document.getElementById("loginResult");

  if(!email || !password){
    resultDiv.textContent = "Please enter email & password.";
    return;
  }

  const { data, error } = await supabase.auth.signInWithPassword({ email, password });
  if(error){ 
    resultDiv.textContent = "Login failed: " + error.message; 
    return; 
  }
  resultDiv.textContent = "✅ Logged in!";
}

async function logout(){
  await supabase.auth.signOut();
  document.getElementById("loginResult").textContent = "Logged out.";
}

// -------- VOCAB QUIZ ----------
async function loadVocab() {
  const { data, error } = await supabase
    .from("nail_vocab_quiz")
    .select("*")
    .order("id", { ascending: true })
    .limit(1);

  if(error || !data || data.length === 0){
    document.getElementById("vocabQuestion").textContent = "Error loading question: " + (error?.message || "No data");
    return;
  }

  currentVocab = data[0];
  document.getElementById("vocabQuestion").textContent = currentVocab.question;
}

async function submitVocab(){
  const answer = document.getElementById("vocabAnswer").value.trim();
  const resultDiv = document.getElementById("vocabResult");
  if(!answer){ resultDiv.textContent="Enter answer"; return; }

  const correct = answer.toLowerCase() === currentVocab.answer.toLowerCase();
  resultDiv.textContent = correct ? "✅ Correct!" : "❌ Incorrect. Correct: " + currentVocab.answer;

  // Save progress if logged in
  const { data: user } = await supabase.auth.getUser();
  if(user?.user){
    await supabase.from("nail_lang_progress").insert({ 
      user_id:user.user.id, 
      quiz_type:'vocab', 
      question_id:currentVocab.id, 
      correct 
    });
  }

  document.getElementById("vocabAnswer").value = "";
  await loadVocab();
}

// -------- SENTENCE QUIZ ----------
async function loadSentence(){
  const { data: sentences, error } = await supabase
    .from("nail_sentence_quiz")
    .select("*")
    .order("id",{ascending:true})
    .limit(1);

  if(error || !sentences || sentences.length===0){
    document.getElementById("sentenceQuestion").textContent="Error: "+(error?.message||"No data");
    return;
  }

  const sentence = sentences[0];
  const { data: words } = await supabase
    .from("nail_sentence_words")
    .select("word")
    .eq("sentence_id", sentence.id);

  if(!words || words.length===0){
    document.getElementById("sentenceQuestion").textContent="Error loading words";
    return;
  }

  currentSentence = sentence;
  const shuffled = words.map(w=>w.word).sort(()=>Math.random()-0.5);
  document.getElementById("sentenceQuestion").textContent = "Arrange words: " + shuffled.join(" ");
}

async function submitSentence(){
  const answer = document.getElementById("sentenceAnswer").value.trim();
  const resultDiv = document.getElementById("sentenceResult");
  if(!answer){ resultDiv.textContent="Enter answer"; return; }

  const correct = answer.toLowerCase() === currentSentence.sentence.toLowerCase();
  resultDiv.textContent = correct ? "✅ Correct!" : "❌ Incorrect. Correct: " + currentSentence.sentence;

  // Save progress if logged in
  const { data: user } = await supabase.auth.getUser();
  if(user?.user){
    await supabase.from("nail_lang_progress").insert({ 
      user_id:user.user.id, 
      quiz_type:'sentence', 
      question_id:currentSentence.id, 
      correct 
    });
  }

  document.getElementById("sentenceAnswer").value = "";
  await loadSentence();
}

// -------- INITIAL LOAD ----------
loadVocab();
loadSentence();

</script>
</body>
</html>
