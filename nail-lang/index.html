<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NailLang</title>

<style>
body { margin:0; font-family:Arial; background:#0f172a; color:white; text-align:center; }
button { padding:10px 20px; margin:5px; cursor:pointer; }
input, select { padding:10px; margin:10px; font-size:16px; }

#quizModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:black;
  justify-content:center;
  align-items:center;
  flex-direction:column;
}

#closeBtn {
  position:absolute;
  top:20px;
  right:20px;
  font-size:30px;
  cursor:pointer;
}

#printBox {
  display:none;
  background:white;
  color:black;
  padding:40px;
  max-width:800px;
  margin:auto;
}

@media print {
  body * { visibility:hidden; }
  #printBox, #printBox * { visibility:visible; }
  #printBox { position:absolute; top:0; left:0; width:100%; }
}
</style>
</head>
<body>

<h1>NailLang</h1>

<select id="difficulty">
<option value="easy">Easy</option>
<option value="medium">Medium</option>
<option value="hard">Hard</option>
</select>

<br>

<button onclick="startQuiz()">Start Quiz</button>
<button onclick="generatePractice()">Hard Words Print</button>
<button onclick="printResults()">Print Results</button>

<div id="stats"></div>

<div id="quizModal">
<div id="closeBtn" onclick="exitQuiz()">✖</div>
<h2 id="questionText"></h2>
<input id="answerInput">
<button onclick="submitAnswer()">Submit</button>
<div id="resultText"></div>
</div>

<div id="printBox"></div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
 "https://lqkpxervwakucksrnoss.supabase.co",
 "sb_publishable_Sdi0YJz0IPwK9yV-0tLvCw_9IDZQhD8"
);

let currentQuestion=null;
let mistakes=[];
let total=0;
let correctCount=0;

document.addEventListener("keydown",(e)=>{
 if(e.key==="Escape") exitQuiz();
});

function startQuiz(){
 document.getElementById("quizModal").style.display="flex";
 loadQuestion();
}

function exitQuiz(){
 document.getElementById("quizModal").style.display="none";
}

async function loadQuestion(){
 const difficulty=document.getElementById("difficulty").value;

 const { data } = await supabase
  .from("nail_vocab_quiz")
  .select("*")
  .eq("difficulty",difficulty)
  .order("random()")
  .limit(1);

 if(!data || !data.length){
  questionText.textContent="No questions found.";
  return;
 }

 currentQuestion=data[0];
 questionText.textContent=currentQuestion.question;
 answerInput.value="";
 resultText.textContent="";
}

function submitAnswer(){
 const answer=answerInput.value.trim();
 if(!answer) return;

 total++;

 const isCorrect=answer.toLowerCase()===currentQuestion.answer.toLowerCase();

 if(isCorrect){
  correctCount++;
  resultText.textContent="✅ Correct";
 } else {
  resultText.textContent="❌ Incorrect: "+currentQuestion.answer;

  if(mistakes.length < 50){
   mistakes.push({
    word: currentQuestion.question,
    answer: currentQuestion.answer
   });
  }
 }

 updateStats();

 setTimeout(loadQuestion,800);
}

function updateStats(){
 const accuracy= total ? Math.round((correctCount/total)*100) : 0;
 document.getElementById("stats").innerHTML=
  `Total: ${total} | Correct: ${correctCount} | Accuracy: ${accuracy}%`;
}

function generatePractice(){
 if(mistakes.length===0){
  alert("No mistakes recorded.");
  return;
 }

 document.getElementById("printBox").innerHTML=
  "<h2>Hard English Words Practice</h2>"+
  mistakes.map(x=>`<p><strong>${x.word}</strong> = ${x.answer}</p>`).join("")+
  "<br><p><strong>Signed: NailLang</strong></p>";

 document.getElementById("printBox").style.display="block";
 window.print();
}

function printResults(){
 const accuracy= total ? Math.round((correctCount/total)*100) : 0;

 document.getElementById("printBox").innerHTML=
  `<h2>NailLang Official Result</h2>
  <p>Total Attempts: ${total}</p>
  <p>Correct Answers: ${correctCount}</p>
  <p>Accuracy: ${accuracy}%</p>
  <br>
  <p><strong>Certified by NailLang</strong></p>`;

 document.getElementById("printBox").style.display="block";
 window.print();
}
</script>

</body>
</html>
